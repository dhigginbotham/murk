var murk=function(e){return"undefined"!=typeof module&&module.exports?module.exports=e:e}(function(e){function t(e,t,r){if("string"!=typeof t&&"undefined"==typeof r&&(r=t,t=r),r="undefined"==typeof r?!0:!1,"undefined"!=typeof t&&"string"==typeof e){if(h.model[e]=t,h.elems.hasOwnProperty(e))return n(h.elems[e])}else r?m.call(h.model,e):h.model=e;return n(),this}function r(e){return"undefined"!=typeof e?h.model.hasOwnProperty(e)?h.model[e]:null:h.model}function n(e){var t;"undefined"!=typeof e?s(e):(t=h.dom.length?h.dom:o(),Array.prototype.map.call(t,s))}function i(e){e="undefined"==typeof e?document:e;var t=o(e);Array.prototype.map.call(t,s)}function o(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function s(e){var t,r;return t=p(e),r=t(y.selectorPrefix),r&&(t(y.selectorPrefix+"-id")||t(y.selectorPrefix+"-id",y.id),t(y.selectorPrefix+"-id")==y.id&&(h.elems.hasOwnProperty(r)||(h.elems[r]=e,~h.keys.indexOf(r)||(h.keys.push(r),h.dom.push(e)),e.innerHTML&&!h.model.hasOwnProperty(r)&&(h.model[r]=e.innerHTML)),h.model.hasOwnProperty(r)?v(t(y.selectorPrefix+"-val"))!=h.model[r]&&l(r):t(y.selectorPrefix+"-bound",!1))),!1}function l(e){function t(n,i){n.call(h.elems[e],e,function(e,n){return r.length?e?i(e,r):t(r.shift(),i):i?i(null,!0):!0})}h.subscribers.hasOwnProperty(e)||(h.subscribers[e]=[a,d,f]);var r=Array.prototype.slice.call(h.subscribers[e]);t(r.shift())}function u(e,t){function r(e){h.subscribers.hasOwnProperty(e)||(h.subscribers[e]=[a,d,f]),h.subscribers[e].push(t)}return e instanceof Array?Array.prototype.map.call(e,r):r(e),this}function f(e,t){var r,n=p(this);return y.trackCount&&(r=n(y.selectorPrefix+"-count"),n(y.selectorPrefix+"-count",r?parseInt(r,0)+1:1)),t?t(null,!0):void 0}function d(e,t){var r,n,i;return r=p(this),r&&(i=function(t){var n,i;h.filters.hasOwnProperty(t)&&h.model.hasOwnProperty(e)&&(n=r(y.selectorPrefix+"-filtered-val")?v(r(y.selectorPrefix+"-filtered-val")):null,i=h.filters[t].call(this,h.model[e]),"undefined"!=typeof i&&n!=i&&(r(y.selectorPrefix+"-filtered-val",P(i)),this.innerHTML=i))}.bind(this),n=r(y.selectorPrefix+"-filter"),n&&(-1!=n.indexOf(",")&&(n=n.split(",")),n instanceof Array||(n=[n]),Array.prototype.map.call(n,i))),t?t(null,!0):void 0}function c(e,t){return e&&t&&(h.filters[e]=t),this}function a(e,t){var r=p(this);return r(y.selectorPrefix+"-val",P(h.model[e])),r(y.selectorPrefix+"-bound",!0),this.innerHTML=h.model[e],t?t(null,!0):void 0}function p(e){return"undefined"!=typeof e?function(e,t){return"undefined"==typeof t?this.getAttribute(e):this.setAttribute(e,t)}.bind(e):null}function m(e){if("object"==typeof this)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}if(!(this instanceof murk))return new murk(e);var h={model:{},dom:[],elems:{},subscribers:{},filters:{},keys:[],start:Date.now()},y={selectorPrefix:"data-murk",trackCount:!0,dev:!1,id:h.start};e&&m.call(y,e);var P=encodeURIComponent,v=decodeURIComponent;return this.collectDom=i,this.emit=l,this.get=r,this.set=t,this.on=u,this.registerFilter=c,y.dev&&(this.state=h),this});