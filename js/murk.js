var murk=function(e){return"undefined"!=typeof module&&module.exports?module.exports=e:e}(function(e){function t(e,t,r){if("string"!=typeof t&&"undefined"==typeof r&&(r=t,t=r),r="undefined"==typeof r?!0:!1,"undefined"!=typeof t&&"string"==typeof e){if(y.model[e]=t,y.elems.hasOwnProperty(e))return n(y.elems[e])}else r?h.call(y.model,e):y.model=e;return n(),this}function r(e){return"undefined"!=typeof e?y.model.hasOwnProperty(e)?y.model[e]:null:y.model}function n(e){var t;"undefined"!=typeof e?s(e):(t=y.dom.length?y.dom:i(),Array.prototype.forEach.call(t,s))}function o(e){e="undefined"==typeof e?document:e;var t=i(e);Array.prototype.forEach.call(t,s)}function i(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function s(e){var t,r;t=p(e),r=t(P.selectorPrefix),r&&(t(P.selectorPrefix+"-id")||t(P.selectorPrefix+"-id",P.id),t(P.selectorPrefix+"-id")==P.id&&(y.elems.hasOwnProperty(r)||(y.elems[r]=e,~y.keys.indexOf(r)||(y.keys.push(r),y.dom.push(e)),e.innerHTML&&!y.model.hasOwnProperty(r)&&(y.model[r]=e.innerHTML)),y.model.hasOwnProperty(r)?b(t(P.selectorPrefix+"-val"))!=y.model[r]&&l(r):t(P.selectorPrefix+"-bound",!1)))}function l(e){y.subscribers.hasOwnProperty(e)||(y.subscribers[e]=[m,d,c,a]);for(var t=Array.prototype.slice.call(y.subscribers[e]);fn=t.shift();)fn.call(y.elems[e],e)}function f(e,t){function r(e){y.subscribers.hasOwnProperty(e)||(y.subscribers[e]=[m,d,c,a]),y.subscribers[e].push(t)}return e instanceof Array?Array.prototype.forEach.call(e,r):r(e),this}function c(e){if(y.model[e]instanceof Array){var t=document.createDocumentFragment();Array.prototype.forEach.call(y.model[e],function(e){var r=document.createElement(this.nodeName);r.innerHTML=e,t.appendChild(r)},this),this.appendChild(t)}}function a(e){var t,r=p(this);P.trackCount&&(t=r(P.selectorPrefix+"-count"),r(P.selectorPrefix+"-count",t?parseInt(t,0)+1:1))}function d(e){var t,r,n;t=p(this),t&&(n=function(r){var n,o;y.filters.hasOwnProperty(r)&&y.model.hasOwnProperty(e)&&(n=t(P.selectorPrefix+"-filtered-val")?b(t(P.selectorPrefix+"-filtered-val")):null,o=y.filters[r].call(this,y.model[e]),"undefined"!=typeof o&&n!=o&&(t(P.selectorPrefix+"-filtered-val",v(o)),this.innerHTML=o))},r=t(P.selectorPrefix+"-filter"),r&&(-1!=r.indexOf(",")&&(r=r.split(",")),r instanceof Array||(r=[r]),Array.prototype.forEach.call(r,n,this)))}function u(e,t){return e&&t&&(y.filters[e]=t),this}function m(e){var t=p(this);t(P.selectorPrefix+"-val",v(y.model[e])),t(P.selectorPrefix+"-bound",!0),y.model[e]instanceof Array||(this.innerHTML=y.model[e])}function p(e){return"undefined"!=typeof e?function(e,t){return"undefined"==typeof t?this.getAttribute(e):this.setAttribute(e,t)}.bind(e):null}function h(e){if("object"==typeof this)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}if(!(this instanceof murk))return new murk(e);var y={model:{},dom:[],elems:{},subscribers:{},filters:{},keys:[],start:Date.now()},P={selectorPrefix:"data-murk",trackCount:!0,dev:!1,id:y.start};e&&h.call(P,e);var v=encodeURIComponent,b=decodeURIComponent;return this.collectDom=o,this.emit=l,this.get=r,this.set=t,this.on=f,this.registerFilter=u,P.dev&&(this.state=y),this});