!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t:window[e]=t}("murk",function e(t){function r(e,t,r){return"boolean"==typeof t&&"undefined"==typeof r&&(r=t,t=r),r="undefined"!=typeof r?r:!0,"undefined"!=typeof t&&"string"==typeof e?(k.model[e]=t,k.elems.hasOwnProperty(e)&&a(k.elems[e]),this):(r?P(k.model,e):k.model=e,o(),this)}function n(e){return"undefined"!=typeof e?k.model.hasOwnProperty(e)?k.model[e]:null:k.model}function o(){var e=k.dom.length?k.dom:i();Array.prototype.forEach.call(e,a)}function s(e){e="undefined"==typeof e?document:e;var t=i(e);Array.prototype.forEach.call(t,a)}function i(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function a(e){var t,r;t=b(e),r=t(v.selectorPrefix),r&&(t(v.selectorPrefix+"-id")||t(v.selectorPrefix+"-id",v.id),t(v.selectorPrefix+"-id")==v.id&&(k.elems.hasOwnProperty(r)||(k.elems[r]=e,~k.keys.indexOf(r)||(k.keys.push(r),k.dom.push(e)),e.innerHTML&&!k.model.hasOwnProperty(r)&&(k.model[r]=e.innerHTML)),k.model.hasOwnProperty(r)&&(l(r),++k.totalCount)))}function l(e){k.subscribers.hasOwnProperty(e)||(k.subscribers[e]=Array.prototype.slice.call(v.defaultSubscribers));for(var t,r=Array.prototype.slice.call(k.subscribers[e]);t=r.shift();)t.call(k.elems[e],e)}function d(e,t){function r(e){k.subscribers.hasOwnProperty(e)||(k.subscribers[e]=Array.prototype.slice.call(v.defaultSubscribers)),k.subscribers[e].push(t)}return e instanceof Array||(e=[e]),Array.prototype.forEach.call(e,r),this}function u(e){var t,r,n=b(e);if(n&&(t=n(v.selectorPrefix+"-repeat-key"),r=n(v.selectorPrefix+"-repeat-bind"),t&&this.hasOwnProperty(t)&&(e.innerHTML!=this[t]&&m(e,this[t]),r))){var o=this.$key+"."+t;n(v.selectorPrefix)||n(v.selectorPrefix,o),a(e)}}function f(e){var t,r,n,o;if(k.model[e]instanceof Array){if("none"!=this.style.display&&(this.style.display="none"),t=k.model[e],k.repeats.hasOwnProperty(e)||(k.repeats[e]={}),n=document.createDocumentFragment(),r=Object.keys(k.repeats[e]),r.length>t.length)for(var s=t.length;s<r.length;++s)"none"!=k.repeats[e][r[s]].style.display&&(k.repeats[e][r[s]].style.display="none");o=function(r,o){var s,i=e+".$"+o,a=!1;k.repeats[e].hasOwnProperty(i)||(k.repeats[e][i]=this.cloneNode(!0),a=!0),s=k.repeats[e][i],s.innerHTML!=t&&(a&&(delete s.dataset.murk,delete s.dataset.murkCount,delete s.dataset.murkBound,s.dataset.murkRepeat=i),"object"==typeof r?(r.$key=i,Array.prototype.forEach.call(s.getElementsByTagName("*"),u,r)):m(s,r),"none"==s.style.display&&(s.style.display=""),a&&n.appendChild(s))},Array.prototype.forEach.call(t,o,this),n.hasChildNodes()&&this.parentNode.appendChild(n)}}function c(e){var t,r;"murkFilter"in this.dataset&&(t=this.dataset.murkFilter,r=function(t){if(k.filters.hasOwnProperty(t)&&k.model.hasOwnProperty(e)){var r=k.filters[t].call(this,k.model[e]);m(this,r)}},-1!=t.indexOf(",")&&(t=t.split(",")),t instanceof Array||(t=[t]),Array.prototype.forEach.call(t,r,this))}function p(e,t){return e&&t&&(k.filters[e]=t),this}function y(e){k.model[e]instanceof Array||"object"==typeof k.model[e]||k.model[e]!=this.innerHTML&&m(this,k.model[e])}function h(){var e="murkCount"in this.dataset?this.dataset.murkCount:null;this.dataset.murkCount=e?parseInt(e,0)+1:1}function m(e,t){if("undefined"!=typeof t){("null"===t||null===t)&&(t="");var r=document.createTextNode(t);e.hasChildNodes()?e.childNodes[0].nodeValue=t:e.appendChild(r)}}function b(e){return"undefined"!=typeof e?function(t,r){return"undefined"==typeof r?e.getAttribute(t):"rm"==r?e.removeAttribute(t):e.setAttribute(t,r)}:null}function P(e,t){if("object"==typeof e)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}if(!(this instanceof e))return new e(t);var k={model:{},dom:[],elems:{},repeats:{},subscribers:{},filters:{},keys:[],start:Date.now(),totalCount:0},v={selectorPrefix:"data-murk",dev:!1,id:k.start,defaultSubscribers:[f,y,c,h]};return t&&P(v,t),this.collectDom=s,this.emit=l,this.get=n,this.set=r,this.on=d,this.registerFilter=p,v.dev&&(this.state=k),this});