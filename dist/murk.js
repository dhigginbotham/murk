var murk=function(e){return"undefined"!=typeof module&&module.exports?void(module.exports=e):e}(function(e){function t(e,t,r){return"boolean"==typeof t&&"undefined"==typeof r&&(r=t,t=r),r="undefined"!=typeof r?r:!0,"undefined"!=typeof t&&"string"==typeof e?(P.model[e]=t,P.elems.hasOwnProperty(e)&&o(P.elems[e]),this):(r?m(P.model,e):P.model=e,o(),this)}function r(e){return"undefined"!=typeof e?P.model.hasOwnProperty(e)?P.model[e]:null:P.model}function o(e){var t;"undefined"!=typeof e?i(e):(t=P.dom.length?P.dom:s(),Array.prototype.forEach.call(t,i))}function n(e){e="undefined"==typeof e?document:e;var t=s(e);Array.prototype.forEach.call(t,i)}function s(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function i(e){var t,r;t=h(e),r=t(b.selectorPrefix),r&&(t(b.selectorPrefix+"-id")||t(b.selectorPrefix+"-id",b.id),t(b.selectorPrefix+"-id")==b.id&&(P.elems.hasOwnProperty(r)||(P.elems[r]=e,~P.keys.indexOf(r)||(P.keys.push(r),P.dom.push(e)),e.innerHTML&&!P.model.hasOwnProperty(r)&&(P.model[r]=e.innerHTML)),P.model.hasOwnProperty(r)?(v(t(b.selectorPrefix+"-val"))!=P.model[r]||"object"==typeof P.model[r])&&l(r):t(b.selectorPrefix+"-bound",!1),++P.totalCount))}function l(e){P.subscribers.hasOwnProperty(e)||(P.subscribers[e]=Array.prototype.slice.call(b.defaultSubscribers));for(var t=Array.prototype.slice.call(P.subscribers[e]);fn=t.shift();)fn.call(P.elems[e],e)}function a(e,t){function r(e){P.subscribers.hasOwnProperty(e)||(P.subscribers[e]=Array.prototype.slice.call(b.defaultSubscribers)),P.subscribers[e].push(t)}return e instanceof Array||(e=[e]),Array.prototype.forEach.call(e,r),this}function f(e){var t=h(e);if(t){var r=t(b.selectorPrefix+"-repeat");r&&this.hasOwnProperty(r)&&(e.innerHTML=this[r])}}function c(e){var t,r,o,n,s,i,l=!1;if(P.model[e]instanceof Array&&(t=P.model[e],r=h(this),o=r(b.selectorPrefix+"-repeat"))){if(P.repeats.hasOwnProperty(e)||(P.repeats[e]={},P.repeats.hasOwnProperty("elems")||(P.repeats[e].elems={})),s=document.createDocumentFragment(),n=Object.keys(P.repeats[e].elems),n.length>t.length)for(var a=t.length;a<n.length;++a)P.repeats[e].elems[n[a]].style.display="none";i=function(r,o){var n,i,a=e+".$"+o;P.repeats[e].elems.hasOwnProperty(a)||(P.repeats[e].elems[a]=this.cloneNode(!0),this.style.display="none",l=!0),n=P.repeats[e].elems[a],n.innerHTML!=t&&(i=h(n),i&&(i(b.selectorPrefix)&&(i(b.selectorPrefix,"rm"),i(b.selectorPrefix+"-repeat","rm"),i(b.selectorPrefix+"-count","rm"),i(b.selectorPrefix+"-parent",e),i(b.selectorPrefix+"-index",o)),"object"==typeof r?Array.prototype.forEach.call(n.getElementsByTagName("*"),f,r):n.innerHTML=r,n.style.display="block",l&&s.appendChild(n)))},Array.prototype.forEach.call(t,i,this),P.repeats.hasOwnProperty(e)&&l&&this.parentNode.appendChild(s)}}function d(){var e,t=h(this);e=t(b.selectorPrefix+"-count"),t(b.selectorPrefix+"-count",e?parseInt(e,0)+1:1)}function u(e){var t,r,o;t=h(this),t&&(r=t(b.selectorPrefix+"-filter"),r&&(o=function(r){var o,n;P.filters.hasOwnProperty(r)&&P.model.hasOwnProperty(e)&&(o=t(b.selectorPrefix+"-filtered-val")?v(t(b.selectorPrefix+"-filtered-val")):null,n=P.filters[r].call(this,P.model[e]),"undefined"!=typeof n&&o!=n&&(t(b.selectorPrefix+"-filtered-val",x(n)),this.innerHTML=n))},-1!=r.indexOf(",")&&(r=r.split(",")),r instanceof Array||(r=[r]),Array.prototype.forEach.call(r,o,this)))}function p(e,t){return e&&t&&(P.filters[e]=t),this}function y(e){var t=h(this);t(b.selectorPrefix+"-bound",!0),P.model[e]instanceof Array||"object"==typeof P.model[e]||(t(b.selectorPrefix+"-val",x(P.model[e])),this.innerHTML=P.model[e],b.dev&&console.log(e,P.totalCount))}function h(e){return"undefined"!=typeof e?function(e,t){return"undefined"==typeof t?this.getAttribute(e):"rm"==t?this.removeAttribute(e):this.setAttribute(e,t)}.bind(e):null}function m(e,t){if("object"==typeof e)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}if(!(this instanceof murk))return new murk(e);var P={model:{},dom:[],elems:{},repeats:{},subscribers:{},filters:{},keys:[],start:Date.now(),totalCount:0},b={selectorPrefix:"data-murk",dev:!1,id:P.start,defaultSubscribers:[c,y,u,d]};e&&m(b,e);var x=encodeURIComponent,v=decodeURIComponent;return this.collectDom=n,this.emit=l,this.get=r,this.set=t,this.on=a,this.registerFilter=p,b.dev&&(this.state=P),this});