!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t:window[e]=t}("murk",function e(t){function r(e,t,r){return"boolean"==typeof t&&"undefined"==typeof r&&(r=t,t=r),r="undefined"==typeof r||r,"undefined"!=typeof t&&"string"==typeof e?(w.model[e]=t,w.elems.hasOwnProperty(e)&&l(w.elems[e]),this):(r?O(w.model,e):w.model=e,n(),this)}function i(e){return"undefined"!=typeof e?w.model.hasOwnProperty(e)?w.model[e]:null:w.model}function n(){var e=w.dom.length?w.dom:o();Array.prototype.forEach.call(e,l)}function s(e){e="undefined"==typeof e?document:e;var t=o(e);Array.prototype.forEach.call(t,l)}function o(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function l(e){var t,r,i;t=v(e),r=t(A.selectorPrefix),i=t(A.selectorPrefix+"-linked"),r&&(t(A.selectorPrefix+"-id")||t(A.selectorPrefix+"-id",A.id),t(A.selectorPrefix+"-id")==A.id&&(w.elems.hasOwnProperty(r)||(w.elems[r]=e,~w.keys.indexOf(r)||(w.keys.push(r),w.dom.push(e)),w.model.hasOwnProperty(r)||(w.model[r]=e.innerHTML||"")),w.model.hasOwnProperty(r)&&(f(r),++w.totalCount)))}function f(e){w.subscribers.hasOwnProperty(e)||(w.subscribers[e]=Array.prototype.slice.call(A.defaultSubscribers));for(var t,r=Array.prototype.slice.call(w.subscribers[e]);t=r.shift();)t.call(w.elems[e],e)}function a(e,t){function r(e){w.subscribers.hasOwnProperty(e)||(w.subscribers[e]=Array.prototype.slice.call(A.defaultSubscribers)),w.subscribers[e].push(t)}return e instanceof Array||(e=[e]),Array.prototype.forEach.call(e,r),this}function c(e){var t,r,i=v(e);if(i&&(t=i(A.selectorPrefix+"-repeat-key"),r=i(A.selectorPrefix+"-repeat-bind"),t&&this.hasOwnProperty(t)&&(x(e,this[t]),r))){var n=this.$key+"."+t;i(A.selectorPrefix)||i(A.selectorPrefix,n),l(e)}}function d(e){var t,r,i,n,s;if(w.model[e]instanceof Array){if("hidden"!=this.style.visibility&&(this.style.visibility="hidden"),t=w.model[e],r=v(this),w.repeats.hasOwnProperty(e)||(w.repeats[e]={}),n=document.createDocumentFragment(),i=Object.keys(w.repeats[e]),i.length>t.length)for(var o=t.length;o<i.length;++o)"hidden"!=w.repeats[e][i[o]].style.visibility&&(w.repeats[e][i[o]].style.visibility="hidden");s=function(r,i){var s,o,l=e+".$"+i,f=!1;w.repeats[e].hasOwnProperty(l)||(w.repeats[e][l]=this.cloneNode(!0),f=!0),s=w.repeats[e][l],s.innerHTML!=t&&(o=v(s),f&&(o(A.selectorPrefix,"rm"),o(A.selectorPrefix+"-count","rm"),o(A.selectorPrefix+"-bound","rm"),o(A.selectorPrefix+"-repeat",l)),"object"==typeof r?(r.$key=l,Array.prototype.forEach.call(s.getElementsByTagName("*"),c,r)):x(s,r),"hidden"==s.style.visibility&&(s.style.visibility=""),f&&n.appendChild(s))},Array.prototype.forEach.call(t,s,this),n.hasChildNodes()&&this.parentNode.appendChild(n)}}function u(e){var t,r,i,n;t=v(this),t&&(r=t(A.selectorPrefix+"-filter"),i=t(A.selectorPrefix+"-filter-mutate"),r&&(n=function(t){if(w.filters.hasOwnProperty(t)&&w.model.hasOwnProperty(e)){var r=w.filters[t].call(this,w.model[e]);"undefined"!=typeof r&&i&&(w.model[e]=r),x(this,r)}},r.indexOf(",")!=-1&&(r=r.split(",")),r instanceof Array||(r=[r]),Array.prototype.forEach.call(r,n,this)))}function y(e,t){return e&&t&&(w.filters[e]=t),this}function h(e){var t=v(this);if(t){var r=k.call(this,e);Array.prototype.forEach.call(r.links,p.bind(null,r),this)}}function p(e,t){if(w.model.hasOwnProperty(t)&&w.elems.hasOwnProperty(t)&&w.links.hasOwnProperty(e.key)&&w.links[e.key].links.indexOf(t)!==-1){var r=w.links.hasOwnProperty(e.key)?w.links[e.key].func.call(this,w.model):null;if(!r)return!1;var i=v(w.elems[t]);i(A.selectorPrefix+"-linked-to")?i(A.selectorPrefix+"-linked-to"):i(A.selectorPrefix+"-linked-to",e.key);return w.model[e.key]=r,x(w.elems[e.key],w.model[e.key])}}function k(e){var t={},r=v(this);return r?(t.links=r(A.selectorPrefix+"-linked")?r(A.selectorPrefix+"-linked"):[],t.linksTo=r(A.selectorPrefix+"-linked-to")?r(A.selectorPrefix+"-linked-to"):null,t.key=t.linksTo?t.linksTo:e,t.links.length?(t.links.indexOf(",")!==-1&&(t.links=t.links.split(",")),t.links instanceof Array||(t.links=[t.links]),w.links.hasOwnProperty(e)&&(w.links[e].links=w.links[e].links.concat(links.filter(function(t){return w.links[e].links.indexOf(t)===-1})))):t.links=t.key&&w.links.hasOwnProperty(t.key)?w.links[t.key].links:[],t):null}function m(e,t,r){return"function"==typeof t&&"undefined"==typeof r&&(r=t,t=[]),w.links[e]={links:t,func:r},this}function P(e){w.model[e]instanceof Array||"object"==typeof w.model[e]||x(this,w.model[e])}function b(){var e,t=v(this);e=t(A.selectorPrefix+"-count"),t(A.selectorPrefix+"-count",e?parseInt(e,0)+1:1)}function x(e,t){if("undefined"!=typeof t){"null"!==t&&null!==t||(t="");var r=document.createTextNode(t);e.hasChildNodes()?e.childNodes[0].nodeValue!=t&&(e.childNodes[0].nodeValue=t):e.appendChild(r)}return e}function v(e){return"undefined"!=typeof e?function(t,r){return"undefined"==typeof r?e.getAttribute(t):"rm"==r?e.removeAttribute(t):e.setAttribute(t,r)}:null}function O(e,t){if("object"==typeof e)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}if(!(this instanceof e))return new e(t);var w={model:{},dom:[],elems:{},repeats:{},subscribers:{},filters:{},links:{},keys:[],start:Date.now(),totalCount:0},A={selectorPrefix:"data-murk",dev:!1,id:w.start,defaultSubscribers:[d,P,u,h,b]};return t&&O(A,t),this.collectDom=s,this.emit=f,this.get=i,this.set=r,this.on=a,this.registerFilter=y,this.linkProperty=m,A.dev&&(this.state=w),this});