var murk=function(e){return"undefined"!=typeof module&&module.exports?void(module.exports=e):e}(function(e){function r(e,r,t){if("boolean"==typeof r&&"undefined"==typeof t&&(t=r,r=t),t="undefined"!=typeof t?t:!0,"undefined"!=typeof r&&"string"==typeof e){if(h.model[e]=r,h.elems.hasOwnProperty(e))return o(h.elems[e])}else t?y(h.model,e):h.model=e;return o(),this}function t(e){return"undefined"!=typeof e?h.model.hasOwnProperty(e)?h.model[e]:null:h.model}function o(e){var r;"undefined"!=typeof e?s(e):(r=h.dom.length?h.dom:i(),Array.prototype.forEach.call(r,s))}function n(e){e="undefined"==typeof e?document:e;var r=i(e);Array.prototype.forEach.call(r,s)}function i(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function s(e){var r,t;r=m(e),t=r(b.selectorPrefix),t&&(r(b.selectorPrefix+"-id")||r(b.selectorPrefix+"-id",b.id),r(b.selectorPrefix+"-id")==b.id&&(h.elems.hasOwnProperty(t)||(h.elems[t]=e,~h.keys.indexOf(t)||(h.keys.push(t),h.dom.push(e)),e.innerHTML&&!h.model.hasOwnProperty(t)&&(h.model[t]=e.innerHTML)),h.model.hasOwnProperty(t)?(v(r(b.selectorPrefix+"-val"))!=h.model[t]||"object"==typeof h.model[t])&&l(t):r(b.selectorPrefix+"-bound",!1)))}function l(e){h.subscribers.hasOwnProperty(e)||(h.subscribers[e]=Array.prototype.slice.call(b.defaultSubscribers));for(var r=Array.prototype.slice.call(h.subscribers[e]);fn=r.shift();)fn.call(h.elems[e],e)}function f(e,r){function t(e){h.subscribers.hasOwnProperty(e)||(h.subscribers[e]=Array.prototype.slice.call(b.defaultSubscribers)),h.subscribers[e].push(r)}return e instanceof Array||(e=[e]),Array.prototype.forEach.call(e,t),this}function a(e){if(h.model[e]instanceof Array){var r=h.model[e],t=m(this),o=t(b.selectorPrefix+"-repeat");if(o){var n=document.createDocumentFragment();Array.prototype.forEach.call(r,function(r,t){var o=e+".$"+t,i=h.elems.hasOwnProperty(o)?h.elems[o]:this.cloneNode(!0),s=m(i);if(s(b.selectorPrefix,"rm"),"object"==typeof r){h.elems[o]=i;var l=i.getElementsByTagName("*");Array.prototype.forEach.call(l,function(e){var t=m(e);if(t){var o=t(b.selectorPrefix+"-repeat");o&&r.hasOwnProperty(o)&&(e.innerHTML=r[o])}},this)}else h.elems[o]=i,i.innerHTML=r;n.appendChild(i)},this),h.elems.hasOwnProperty(e)&&this.parentNode.appendChild(n)}}}function c(){var e,r=m(this);e=r(b.selectorPrefix+"-count"),r(b.selectorPrefix+"-count",e?parseInt(e,0)+1:1)}function d(e){var r,t,o;r=m(this),r&&(t=r(b.selectorPrefix+"-filter"),t&&(o=function(t){var o,n;h.filters.hasOwnProperty(t)&&h.model.hasOwnProperty(e)&&(o=r(b.selectorPrefix+"-filtered-val")?v(r(b.selectorPrefix+"-filtered-val")):null,n=h.filters[t].call(this,h.model[e]),"undefined"!=typeof n&&o!=n&&(r(b.selectorPrefix+"-filtered-val",P(n)),this.innerHTML=n))},-1!=t.indexOf(",")&&(t=t.split(",")),t instanceof Array||(t=[t]),Array.prototype.forEach.call(t,o,this)))}function u(e,r){return e&&r&&(h.filters[e]=r),this}function p(e){var r=m(this);r(b.selectorPrefix+"-val",P(h.model[e])),r(b.selectorPrefix+"-bound",!0),h.model[e]instanceof Array||"object"==typeof h.model[e]||(this.innerHTML=h.model[e])}function m(e){return"undefined"!=typeof e?function(e,r){return"undefined"==typeof r?this.getAttribute(e):"rm"==r?this.removeAttribute(e):this.setAttribute(e,r)}.bind(e):null}function y(e,r){if("object"==typeof e)for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}if(!(this instanceof murk))return new murk(e);var h={model:{},dom:[],elems:{},subscribers:{},filters:{},keys:[],start:Date.now()},b={selectorPrefix:"data-murk",dev:!1,id:h.start,defaultSubscribers:[a,p,d,c]};e&&y(b,e);var P=encodeURIComponent,v=decodeURIComponent;return this.collectDom=n,this.emit=l,this.get=t,this.set=r,this.on=f,this.registerFilter=u,b.dev&&(this.state=h),this});