var murk=function(e){return"undefined"!=typeof module&&module.exports?void(module.exports=e):e}(function(e){function t(e,t,r){return"boolean"==typeof t&&"undefined"==typeof r&&(r=t,t=r),r="undefined"!=typeof r?r:!0,"undefined"!=typeof t&&"string"==typeof e?(P.model[e]=t,P.elems.hasOwnProperty(e)&&i(P.elems[e]),this):(r?b(P.model,e):P.model=e,n(),this)}function r(e){return"undefined"!=typeof e?P.model.hasOwnProperty(e)?P.model[e]:null:P.model}function n(){var e=P.dom.length?P.dom:s();Array.prototype.forEach.call(e,i)}function o(e){e="undefined"==typeof e?document:e;var t=s(e);Array.prototype.forEach.call(t,i)}function s(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function i(e){var t,r;t=m(e),r=t(v.selectorPrefix),r&&(t(v.selectorPrefix+"-id")||t(v.selectorPrefix+"-id",v.id),t(v.selectorPrefix+"-id")==v.id&&(P.elems.hasOwnProperty(r)||(P.elems[r]=e,~P.keys.indexOf(r)||(P.keys.push(r),P.dom.push(e)),e.innerHTML&&!P.model.hasOwnProperty(r)&&(P.model[r]=e.innerHTML)),P.model.hasOwnProperty(r)&&(l(r),++P.totalCount)))}function l(e){P.subscribers.hasOwnProperty(e)||(P.subscribers[e]=Array.prototype.slice.call(v.defaultSubscribers));for(var t,r=Array.prototype.slice.call(P.subscribers[e]);t=r.shift();)t.call(P.elems[e],e)}function a(e,t){function r(e){P.subscribers.hasOwnProperty(e)||(P.subscribers[e]=Array.prototype.slice.call(v.defaultSubscribers)),P.subscribers[e].push(t)}return e instanceof Array||(e=[e]),Array.prototype.forEach.call(e,r),this}function f(e){var t,r=m(e);if(r&&(t=r(v.selectorPrefix+"-repeat-key"),t&&this.hasOwnProperty(t)&&(null===this[t]||"null"===this[t]?h(e,""):e.innerHTML!=this[t]&&h(e,this[t]),v.bindRepeats))){var n=this.$key+"."+t;r(v.selectorPrefix)||r(v.selectorPrefix,n),i(e)}}function d(e){var t,r,n,o,s;if(P.model[e]instanceof Array){if("none"!=this.style.display&&(this.style.display="none"),t=P.model[e],r=m(this),P.repeats.hasOwnProperty(e)||(P.repeats[e]={}),o=document.createDocumentFragment(),n=Object.keys(P.repeats[e]),n.length>t.length)for(var i=t.length;i<n.length;++i)"none"!=P.repeats[e][n[i]].style.display&&(P.repeats[e][n[i]].style.display="none");s=function(r,n){var s,i,l=e+".$"+n,a=!1;P.repeats[e].hasOwnProperty(l)||(P.repeats[e][l]=this.cloneNode(!0),a=!0),s=P.repeats[e][l],s.innerHTML!=t&&(i=m(s),a&&(i(v.selectorPrefix,"rm"),i(v.selectorPrefix+"-count","rm"),i(v.selectorPrefix+"-bound","rm"),i(v.selectorPrefix+"-repeat",l)),"object"==typeof r?(r.$key=l,Array.prototype.forEach.call(s.getElementsByTagName("*"),f,r)):s.innerHTML=r,"none"==s.style.display&&(s.style.display=""),a&&o.appendChild(s))},Array.prototype.forEach.call(t,s,this),o.hasChildNodes()&&this.parentNode.appendChild(o)}}function c(e){var t,r,n;t=m(this),t&&(r=t(v.selectorPrefix+"-filter"),r&&(n=function(t){if(P.filters.hasOwnProperty(t)&&P.model.hasOwnProperty(e)){var r=P.filters[t].call(this,P.model[e]);"undefined"!=typeof r&&h(this,r)}},-1!=r.indexOf(",")&&(r=r.split(",")),r instanceof Array||(r=[r]),Array.prototype.forEach.call(r,n,this)))}function u(e,t){return e&&t&&(P.filters[e]=t),this}function p(e){P.model[e]instanceof Array||"object"==typeof P.model[e]||P.model[e]!=this.innerHTML&&h(this,P.model[e])}function y(){var e,t=m(this);e=t(v.selectorPrefix+"-count"),t(v.selectorPrefix+"-count",e?parseInt(e,0)+1:1)}function h(e,t){var r=null;"undefined"!=typeof t&&(r=document.createTextNode(t)),e.hasChildNodes()?e.childNodes[0].nodeValue=t:e.appendChild(r)}function m(e){return"undefined"!=typeof e?function(t,r){return"undefined"==typeof r?e.getAttribute(t):"rm"==r?e.removeAttribute(t):e.setAttribute(t,r)}:null}function b(e,t){if("object"==typeof e)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}if(!(this instanceof murk))return new murk(e);var P={model:{},dom:[],elems:{},repeats:{},subscribers:{},filters:{},keys:[],start:Date.now(),totalCount:0},v={selectorPrefix:"data-murk",dev:!1,id:P.start,bindRepeats:!1,defaultSubscribers:[d,p,c,y]};e&&b(v,e);encodeURIComponent,decodeURIComponent;return this.collectDom=o,this.emit=l,this.get=r,this.set=t,this.on=a,this.registerFilter=u,v.dev&&(this.state=P),this});