var murk=function(e){return"undefined"!=typeof module&&module.exports?void(module.exports=e):e}(function(e){function t(e,t,r){return"boolean"==typeof t&&"undefined"==typeof r&&(r=t,t=r),r="undefined"!=typeof r?r:!0,"undefined"!=typeof t&&"string"==typeof e?(m.model[e]=t,m.elems.hasOwnProperty(e)&&o(m.elems[e]),this):(r?h(m.model,e):m.model=e,o(),this)}function r(e){return"undefined"!=typeof e?m.model.hasOwnProperty(e)?m.model[e]:null:m.model}function o(e){var t;"undefined"!=typeof e?i(e):(t=m.dom.length?m.dom:s(),Array.prototype.forEach.call(t,i))}function n(e){e="undefined"==typeof e?document:e;var t=s(e);Array.prototype.forEach.call(t,i)}function s(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function i(e){var t,r;t=y(e),r=t(P.selectorPrefix),r&&(t(P.selectorPrefix+"-id")||t(P.selectorPrefix+"-id",P.id),t(P.selectorPrefix+"-id")==P.id&&(m.elems.hasOwnProperty(r)||(m.elems[r]=e,~m.keys.indexOf(r)||(m.keys.push(r),m.dom.push(e)),e.innerHTML&&!m.model.hasOwnProperty(r)&&(m.model[r]=e.innerHTML)),m.model.hasOwnProperty(r)?(v(t(P.selectorPrefix+"-val"))!=m.model[r]||"object"==typeof m.model[r])&&(l(r),t(P.selectorPrefix+"-bound")||t(P.selectorPrefix+"-bound",!0)):t(P.selectorPrefix+"-bound",!1),++m.totalCount))}function l(e){m.subscribers.hasOwnProperty(e)||(m.subscribers[e]=Array.prototype.slice.call(P.defaultSubscribers));for(var t=Array.prototype.slice.call(m.subscribers[e]);fn=t.shift();)fn.call(m.elems[e],e)}function a(e,t){function r(e){m.subscribers.hasOwnProperty(e)||(m.subscribers[e]=Array.prototype.slice.call(P.defaultSubscribers)),m.subscribers[e].push(t)}return e instanceof Array||(e=[e]),Array.prototype.forEach.call(e,r),this}function f(e){var t,r,o,n,s,i=!1;if(m.model[e]instanceof Array){if(t=m.model[e],r=y(this),m.repeats.hasOwnProperty(e)||(m.repeats[e]={},m.repeats.hasOwnProperty("elems")||(m.repeats[e].elems={})),n=document.createDocumentFragment(),o=Object.keys(m.repeats[e].elems),o.length>t.length)for(var l=t.length;l<o.length;++l)m.repeats[e].elems[o[l]].style.display="none";s=function(r,o){var s,l,a,f=e+".$"+o;a=function(e){var t,r=y(e);r&&(t=r(P.selectorPrefix+"-repeat-key"),t&&this.hasOwnProperty(t)&&e.innerHTML!=this[t]&&(e.innerHTML=this[t]))},m.repeats[e].elems.hasOwnProperty(f)||(m.repeats[e].elems[f]=this.cloneNode(!0),this.style.display="none",i=!0),s=m.repeats[e].elems[f],s.innerHTML!=t&&(l=y(s),i&&(l(P.selectorPrefix,"rm"),l(P.selectorPrefix+"-count","rm"),l(P.selectorPrefix+"-index",o)),"object"==typeof r?Array.prototype.forEach.call(s.getElementsByTagName("*"),a,r):s.innerHTML=r,s.style.display="block",i&&n.appendChild(s))},Array.prototype.forEach.call(t,s,this),m.repeats.hasOwnProperty(e)&&i&&this.parentNode.appendChild(n)}}function c(e){var t,r,o;t=y(this),t&&(r=t(P.selectorPrefix+"-filter"),r&&(o=function(r){var o,n;m.filters.hasOwnProperty(r)&&m.model.hasOwnProperty(e)&&(o=t(P.selectorPrefix+"-filtered-val")?v(t(P.selectorPrefix+"-filtered-val")):null,n=m.filters[r].call(this,m.model[e]),"undefined"!=typeof n&&o!=n&&(t(P.selectorPrefix+"-filtered-val",b(n)),this.innerHTML=n))},-1!=r.indexOf(",")&&(r=r.split(",")),r instanceof Array||(r=[r]),Array.prototype.forEach.call(r,o,this)))}function d(e,t){return e&&t&&(m.filters[e]=t),this}function u(e){var t=y(this);m.model[e]instanceof Array||"object"==typeof m.model[e]||(t(P.selectorPrefix+"-val",b(m.model[e])),m.model[e]!=this.innerHTML&&(this.innerHTML=m.model[e],P.dev&&console.log(e,m.totalCount)))}function p(){var e,t=y(this);e=t(P.selectorPrefix+"-count"),t(P.selectorPrefix+"-count",e?parseInt(e,0)+1:1)}function y(e){return"undefined"!=typeof e?function(e,t){return"undefined"==typeof t?this.getAttribute(e):"rm"==t?this.removeAttribute(e):this.setAttribute(e,t)}.bind(e):null}function h(e,t){if("object"==typeof e)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}if(!(this instanceof murk))return new murk(e);var m={model:{},dom:[],elems:{},repeats:{},subscribers:{},filters:{},keys:[],start:Date.now(),totalCount:0},P={selectorPrefix:"data-murk",dev:!1,id:m.start,defaultSubscribers:[f,u,c,p]};e&&h(P,e);var b=encodeURIComponent,v=decodeURIComponent;return this.collectDom=n,this.emit=l,this.get=r,this.set=t,this.on=a,this.registerFilter=d,P.dev&&(this.state=m),this});