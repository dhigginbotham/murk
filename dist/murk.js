!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t:window[e]=t}("murk",function e(t){function r(e,t,r){return"boolean"==typeof t&&"undefined"==typeof r&&(r=t,t=r),r="undefined"!=typeof r?r:!0,"undefined"!=typeof t&&"string"==typeof e?(v.model[e]=t,v.elems.hasOwnProperty(e)&&l(v.elems[e]),this):(r?P(v.model,e):v.model=e,o(),this)}function i(e){return"undefined"!=typeof e?v.model.hasOwnProperty(e)?v.model[e]:null:v.model}function o(){var e=v.dom.length?v.dom:s();Array.prototype.forEach.call(e,l)}function n(e){e="undefined"==typeof e?document:e;var t=s(e);Array.prototype.forEach.call(t,l)}function s(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function l(e){var t,r;t=b(e),r=t(x.selectorPrefix),r&&(t(x.selectorPrefix+"-id")||t(x.selectorPrefix+"-id",x.id),t(x.selectorPrefix+"-id")==x.id&&(v.elems.hasOwnProperty(r)||(v.elems[r]=e,~v.keys.indexOf(r)||(v.keys.push(r),v.dom.push(e)),e.innerHTML&&!v.model.hasOwnProperty(r)&&(v.model[r]=e.innerHTML)),v.model.hasOwnProperty(r)&&(a(r),++v.totalCount)))}function a(e){v.subscribers.hasOwnProperty(e)||(v.subscribers[e]=Array.prototype.slice.call(x.defaultSubscribers));for(var t,r=Array.prototype.slice.call(v.subscribers[e]);t=r.shift();)t.call(v.elems[e],e)}function f(e,t){function r(e){v.subscribers.hasOwnProperty(e)||(v.subscribers[e]=Array.prototype.slice.call(x.defaultSubscribers)),v.subscribers[e].push(t)}return e instanceof Array||(e=[e]),Array.prototype.forEach.call(e,r),this}function d(e){var t,r,i=b(e);if(i&&(t=i(x.selectorPrefix+"-repeat-key"),r=i(x.selectorPrefix+"-repeat-bind"),t&&this.hasOwnProperty(t)&&(m(e,this[t]),r))){var o=this.$key+"."+t;i(x.selectorPrefix)||i(x.selectorPrefix,o),l(e)}}function c(e){var t,r,i,o,n;if(v.model[e]instanceof Array){if("hidden"!=this.style.visibility&&(this.style.visibility="hidden"),t=v.model[e],r=b(this),v.repeats.hasOwnProperty(e)||(v.repeats[e]={}),o=document.createDocumentFragment(),i=Object.keys(v.repeats[e]),i.length>t.length)for(var s=t.length;s<i.length;++s)"hidden"!=v.repeats[e][i[s]].style.visibility&&(v.repeats[e][i[s]].style.visibility="hidden");n=function(r,i){var n,s,l=e+".$"+i,a=!1;v.repeats[e].hasOwnProperty(l)||(v.repeats[e][l]=this.cloneNode(!0),a=!0),n=v.repeats[e][l],n.innerHTML!=t&&(s=b(n),a&&(s(x.selectorPrefix,"rm"),s(x.selectorPrefix+"-count","rm"),s(x.selectorPrefix+"-bound","rm"),s(x.selectorPrefix+"-repeat",l)),"object"==typeof r?(r.$key=l,Array.prototype.forEach.call(n.getElementsByTagName("*"),d,r)):m(n,r),"hidden"==n.style.visibility&&(n.style.visibility=""),a&&o.appendChild(n))},Array.prototype.forEach.call(t,n,this),o.hasChildNodes()&&this.parentNode.appendChild(o)}}function u(e){var t,r,i,o;t=b(this),t&&(r=t(x.selectorPrefix+"-filter"),i=t(x.selectorPrefix+"-filter-mutate"),r&&(o=function(t){if(v.filters.hasOwnProperty(t)&&v.model.hasOwnProperty(e)){var r=v.filters[t].call(this,v.model[e]);"undefined"!=typeof r&&i&&(v.model[e]=r),m(this,r)}},-1!=r.indexOf(",")&&(r=r.split(",")),r instanceof Array||(r=[r]),Array.prototype.forEach.call(r,o,this)))}function p(e,t){return e&&t&&(v.filters[e]=t),this}function y(e){v.model[e]instanceof Array||"object"==typeof v.model[e]||m(this,v.model[e])}function h(){var e,t=b(this);e=t(x.selectorPrefix+"-count"),t(x.selectorPrefix+"-count",e?parseInt(e,0)+1:1)}function m(e,t){if("undefined"!=typeof t){("null"===t||null===t)&&(t="");var r=document.createTextNode(t);e.hasChildNodes()?e.childNodes[0].nodeValue!=t&&(e.childNodes[0].nodeValue=t):e.appendChild(r)}}function b(e){return"undefined"!=typeof e?function(t,r){return"undefined"==typeof r?e.getAttribute(t):"rm"==r?e.removeAttribute(t):e.setAttribute(t,r)}:null}function P(e,t){if("object"==typeof e)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}if(!(this instanceof e))return new e(t);var v={model:{},dom:[],elems:{},repeats:{},subscribers:{},filters:{},keys:[],start:Date.now(),totalCount:0},x={selectorPrefix:"data-murk",dev:!1,id:v.start,defaultSubscribers:[c,y,u,h]};return t&&P(x,t),this.collectDom=n,this.emit=a,this.get=i,this.set=r,this.on=f,this.registerFilter=p,x.dev&&(this.state=v),this});