var murk=function(e){return"undefined"!=typeof module&&module.exports?void(module.exports=e):e}(function(e){function r(e,r,t){if("boolean"==typeof r&&"undefined"==typeof t&&(t=r,r=t),t="undefined"!=typeof t?t:!0,"undefined"!=typeof r&&"string"==typeof e){if(h.model[e]=r,h.elems.hasOwnProperty(e))return o(h.elems[e])}else t?m(h.model,e):h.model=e;return o(),this}function t(e){return"undefined"!=typeof e?h.model.hasOwnProperty(e)?h.model[e]:null:h.model}function o(e){var r;"undefined"!=typeof e?i(e):(r=h.dom.length?h.dom:s(),Array.prototype.forEach.call(r,i))}function n(e){e="undefined"==typeof e?document:e;var r=s(e);Array.prototype.forEach.call(r,i)}function s(e){return e="undefined"==typeof e?document:e,e.getElementsByTagName("*")}function i(e){var r,t;r=y(e),t=r(P.selectorPrefix),t&&(r(P.selectorPrefix+"-id")||r(P.selectorPrefix+"-id",P.id),r(P.selectorPrefix+"-id")==P.id&&(h.elems.hasOwnProperty(t)||(h.elems[t]=e,~h.keys.indexOf(t)||(h.keys.push(t),h.dom.push(e)),e.innerHTML&&!h.model.hasOwnProperty(t)&&(h.model[t]=e.innerHTML)),h.model.hasOwnProperty(t)?(v(r(P.selectorPrefix+"-val"))!=h.model[t]||"object"==typeof h.model[t])&&l(t):r(P.selectorPrefix+"-bound",!1)))}function l(e){h.subscribers.hasOwnProperty(e)||(h.subscribers[e]=Array.prototype.slice.call(P.defaultSubscribers));for(var r=Array.prototype.slice.call(h.subscribers[e]);fn=r.shift();)fn.call(h.elems[e],e)}function a(e,r){function t(e){h.subscribers.hasOwnProperty(e)||(h.subscribers[e]=Array.prototype.slice.call(P.defaultSubscribers)),h.subscribers[e].push(r)}return e instanceof Array||(e=[e]),Array.prototype.forEach.call(e,t),this}function f(e){if(h.model[e]instanceof Array){var r=h.model[e],t=y(this),o=t(P.selectorPrefix+"-repeat");if(o){h.repeats.hasOwnProperty(e)||(h.repeats[e]={},h.repeats.hasOwnProperty("elems")||(h.repeats[e].elems={}));var n=Object.keys(h.repeats[e].elems),s=document.createDocumentFragment();if(n.length>r.length)for(var i=r.length;i<n.length;++i)h.repeats[e].elems[n[i]].style.display="none";Array.prototype.forEach.call(r,function(r,t){var o,n=e+".$"+t;h.repeats[e].elems.hasOwnProperty(n)||(h.repeats[e].elems[n]=this.cloneNode(!0)),o=h.repeats[e].elems[n];var i=y(o);if(i){if(i(P.selectorPrefix,"rm"),i(P.selectorPrefix+"-parent",e),"object"==typeof r){var l=o.getElementsByTagName("*");Array.prototype.forEach.call(l,function(e){var t=y(e);if(t){var o=t(P.selectorPrefix+"-repeat");t(P.selectorPrefix+"-key")||t(P.selectorPrefix+"-key",n),o&&(e.parentNode.style.display="inherit",r.hasOwnProperty(o)&&(e.innerHTML=r[o]))}},this)}else o.innerHTML=r;s.appendChild(o)}},this),h.elems.hasOwnProperty(e)&&this.parentNode.appendChild(s)}}return!0}function c(){var e,r=y(this);e=r(P.selectorPrefix+"-count"),r(P.selectorPrefix+"-count",e?parseInt(e,0)+1:1)}function d(e){var r,t,o;r=y(this),r&&(t=r(P.selectorPrefix+"-filter"),t&&(o=function(t){var o,n;h.filters.hasOwnProperty(t)&&h.model.hasOwnProperty(e)&&(o=r(P.selectorPrefix+"-filtered-val")?v(r(P.selectorPrefix+"-filtered-val")):null,n=h.filters[t].call(this,h.model[e]),"undefined"!=typeof n&&o!=n&&(r(P.selectorPrefix+"-filtered-val",b(n)),this.innerHTML=n))},-1!=t.indexOf(",")&&(t=t.split(",")),t instanceof Array||(t=[t]),Array.prototype.forEach.call(t,o,this)))}function u(e,r){return e&&r&&(h.filters[e]=r),this}function p(e){var r=y(this);r(P.selectorPrefix+"-bound",!0),h.model[e]instanceof Array||"object"==typeof h.model[e]||(r(P.selectorPrefix+"-val",b(h.model[e])),this.innerHTML=h.model[e])}function y(e){return"undefined"!=typeof e?function(e,r){return"undefined"==typeof r?this.getAttribute(e):"rm"==r?this.removeAttribute(e):this.setAttribute(e,r)}.bind(e):null}function m(e,r){if("object"==typeof e)for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}if(!(this instanceof murk))return new murk(e);var h={model:{},dom:[],elems:{},repeats:{},subscribers:{},filters:{},keys:[],start:Date.now()},P={selectorPrefix:"data-murk",dev:!1,id:h.start,defaultSubscribers:[p,d,c,f]};e&&m(P,e);var b=encodeURIComponent,v=decodeURIComponent;return this.collectDom=n,this.emit=l,this.get=t,this.set=r,this.on=a,this.registerFilter=u,P.dev&&(this.state=h),this});